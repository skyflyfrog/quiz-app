<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤©ç¿”æµè‡ªæˆ‘å¼·åŒ–æª¢æ ¸è¡¨</title>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #f5f6fa;
      margin: 0;
      padding: 0;
      color: #222;
      text-align: center;
    }
    h1 {
      margin: 30px 0 10px;
      font-size: 28px;
    }
    .subtext {
      font-size: 16px;
      color: #666;
      margin-bottom: 25px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .section-card {
      text-align: left;
      margin-bottom: 20px;
      border: 2px solid #eee;
      border-radius: 10px;
      padding: 15px;
      background: #fafafa;
    }
    .section-card h3 {
      margin: 0 0 8px;
      color: #333;
    }
    .progress-bar {
      width: 100%;
      height: 18px;
      border-radius: 10px;
      background-color: #eee;
      overflow: hidden;
      margin-top: 5px;
    }
    .bar-red { background: #e74c3c; }
    .bar-yellow { background: #f1c40f; }
    .bar-green { background: #2ecc71; }
    .bar-blue { background: #3498db; }
    .btn {
      font-size: 18px;
      margin: 8px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      transition: 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .btn-primary { background-color: #4a90e2; }
    .btn-wrong { background-color: #e74c3c; }
    .btn-correct { background-color: #27ae60; }
    .btn-gray { background-color: #95a5a6; }
    .question-img {
      max-width: 90%;
      border-radius: 10px;
      margin: 10px 0;
    }
    .answer {
      margin-top: 10px;
      font-size: 20px;
      color: #000;
      display: none;
    }
    .gear {
      font-size: 60px;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1>å¤©ç¿”æµè‡ªæˆ‘å¼·åŒ–æª¢æ ¸è¡¨</h1>
  <div class="subtext">ç´…è‰²ï¼šåˆ·çˆ†0è¼ªï¼Œé»ƒè‰²ï¼šåˆ·çˆ†1è¼ªï¼Œç¶ è‰²ï¼šåˆ·çˆ†2è¼ªï¼Œè—è‰²ï¼šåˆ·çˆ†3è¼ª</div>

  <div class="container" id="mainContainer">
    <p>è¼‰å…¥ä¸­...</p>
  </div>

  <script>
    // === å…¨åŸŸè®Šæ•¸ ===
    let quizData = [];
    let currentIndex = 0;
    let currentSection = "";
    let currentSheet = "";
    let tempRecord = {}; // æš«å­˜æœªå®Œæˆåˆ·é¡Œè¨˜éŒ„
    let colorRecord = JSON.parse(localStorage.getItem("colorRecord") || "{}");

    // === æ¨¡æ“¬é¡Œåº«è³‡æ–™ (æ­£å¼ç‰ˆç”¨ fetch æ›¿æ›) ===
    const sheets = {
      "è‡ªç„¶B1L2é¤Šåˆ†": [
        { å°ç¯€: "2-2é…µç´ ", é¡Œç›®: "çœ‹åœ–å›ç­”ï¼šhttps://drive.google.com/uc?id=1LLs8ea96v8gvxinxx3Ns8P7tzwM5w3y<br>A æ˜¯ï¼Ÿ", ç­”æ¡ˆ: "è‚ºéœè„ˆ" },
        { å°ç¯€: "2-2é…µç´ ", é¡Œç›®: "é…µç´ çš„ä½œç”¨æ˜¯ï¼Ÿ", ç­”æ¡ˆ: "å‚¬åŒ–åæ‡‰" },
        { å°ç¯€: "2-3å…‰åˆä½œç”¨", é¡Œç›®: "é€²è¡Œå…‰åˆä½œç”¨çš„ç´°èƒæœ‰å“ªäº›ï¼Ÿ", ç­”æ¡ˆ: "è‘‰è‚‰ç´°èƒã€ä¿è¡›ç´°èƒ" }
      ],
      "è‡ªç„¶B1L3é‹è¼¸": [
        { å°ç¯€: "3-1æ¤ç‰©çš„é‹è¼¸æ§‹é€ ", é¡Œç›®: "æ¤ç‰©æ°´åˆ†çš„é‹è¼¸æ§‹é€ æ˜¯ï¼Ÿ", ç­”æ¡ˆ: "æœ¨è³ªéƒ¨" },
        { å°ç¯€: "3-2æ¤ç‰©çš„ç‰©è³ªé‹è¼¸", é¡Œç›®: "æ¤ç‰©çš„é¤Šåˆ†ç”±å“ªè£¡é‹è¼¸ï¼Ÿ", ç­”æ¡ˆ: "éŸŒçš®éƒ¨" }
      ]
    };

    // === åˆå§‹åŒ–é¦–é  ===
    function initHome() {
      const container = document.getElementById("mainContainer");
      container.innerHTML = "";

      Object.keys(sheets).forEach(sheetName => {
        const sectionBox = document.createElement("div");
        sectionBox.className = "section-card";
        sectionBox.innerHTML = `<h3>${sheetName}</h3>`;

        const subSections = [...new Set(sheets[sheetName].map(q => q.å°ç¯€))];
        subSections.forEach(sec => {
          const total = sheets[sheetName].filter(q => q.å°ç¯€ === sec).length;
          const record = colorRecord?.[sheetName]?.[sec] || { red: total, yellow: 0, green: 0, blue: 0 };

          const totalSum = record.red + record.yellow + record.green + record.blue;
          const rRate = (record.red / totalSum) * 100 || 0;
          const yRate = (record.yellow / totalSum) * 100 || 0;
          const gRate = (record.green / totalSum) * 100 || 0;
          const bRate = (record.blue / totalSum) * 100 || 0;

          sectionBox.innerHTML += `
            <div style="margin-bottom:10px; cursor:pointer;" onclick="startSection('${sheetName}','${sec}')">
              <b>${sec}</b>ã€€${record.red + record.yellow + record.green + record.blue > 0 ? "å·²æœ‰ç´€éŒ„" : "å°šç„¡ç´€éŒ„"}ã€€|ã€€å…± ${total} é¡Œ
              <div class="progress-bar">
                <div class="bar-red" style="width:${rRate}%;height:100%;float:left;"></div>
                <div class="bar-yellow" style="width:${yRate}%;height:100%;float:left;"></div>
                <div class="bar-green" style="width:${gRate}%;height:100%;float:left;"></div>
                <div class="bar-blue" style="width:${bRate}%;height:100%;float:left;"></div>
              </div>
            </div>
          `;
        });
        container.appendChild(sectionBox);
      });

      container.innerHTML += `<button class="btn btn-gray" onclick="resetRecord()">æ¸…é™¤æ‰€æœ‰åˆ·é¡Œç´€éŒ„</button>`;
    }

    // === é–‹å§‹åˆ·é¡Œ ===
    function startSection(sheet, section) {
      currentSheet = sheet;
      currentSection = section;
      quizData = sheets[sheet].filter(q => q.å°ç¯€ === section);
      currentIndex = 0;
      tempRecord = {}; // æ¯è¼ªæ¸…ç©ºæš«å­˜
      showQuestion();
    }
    // === é¡¯ç¤ºé¡Œç›® ===
    function showQuestion() {
      const container = document.getElementById("mainContainer");
      const q = quizData[currentIndex];
      container.innerHTML = "";

      container.innerHTML += `<h2>${currentSheet} ï¼ ${currentSection}</h2>`;
      container.innerHTML += `<p style="color:#777;">ç¬¬ ${currentIndex + 1}/${quizData.length} é¡Œ</p>`;
      container.innerHTML += `<p style="font-size:22px; line-height:1.5;">${q.é¡Œç›®}</p>`;

      // ğŸ” åµæ¸¬åœ–ç‰‡ç¶²å€ä¸¦é¡¯ç¤º
      const urlMatch = q.é¡Œç›®.match(/https?:\/\/[^\s"<]+/);
      if (urlMatch && urlMatch[0].match(/\.(jpg|jpeg|png|gif)|drive\.google\.com\/uc\?id=/)) {
        container.innerHTML += `<img src="${urlMatch[0]}" class="question-img" alt="é¡Œç›®åœ–ç‰‡">`;
      }

      container.innerHTML += `<button class="btn btn-primary" onclick="showAnswer()">å°ç­”æ¡ˆ</button>
        <div id="answerBox" class="answer"><p>${q.ç­”æ¡ˆ}</p></div>`;
    }

    // === é¡¯ç¤ºç­”æ¡ˆéšæ®µ ===
    function showAnswer() {
      document.getElementById("answerBox").style.display = "block";
      const c = document.getElementById("mainContainer");
      c.innerHTML += `
        <br>
        <button class="btn btn-wrong" onclick="nextQuestion(false)">ç­”éŒ¯</button>
        <button class="btn btn-correct" onclick="nextQuestion(true)">ç­”å°</button>
      `;
      document.querySelector(".btn-primary").style.display = "none";
    }

    // === ä¸‹ä¸€é¡Œ ===
    function nextQuestion(correct) {
      tempRecord[currentIndex] = correct;
      currentIndex++;
      if (currentIndex < quizData.length) {
        showQuestion();
      } else {
        showLoading();
        setTimeout(showSummary, 3000);
      }
    }

    // === çµç®—ä¸­å‹•ç•« ===
    function showLoading() {
      document.getElementById("mainContainer").innerHTML = `
        <div style="padding:60px;">
          <div class="gear">âš™ï¸</div>
          <p style="font-size:20px;margin-top:10px;">çµæœçµ±è¨ˆä¸­...</p>
        </div>
      `;
    }

    // === çµç®—ç•«é¢ ===
    function showSummary() {
      const result = colorRecord[currentSheet] = colorRecord[currentSheet] || {};
      result[currentSection] = result[currentSection] || { red: 0, yellow: 0, green: 0, blue: 0 };
      const rec = result[currentSection];
      const total = quizData.length;

      let correctCount = 0;
      for (let i in tempRecord) if (tempRecord[i]) correctCount++;

      // æ­£ç­”ç‡è¶…é 70% æ‰å‡ç´šé¡è‰²
      const accuracy = correctCount / total;
      if (accuracy >= 0.7) {
        if (rec.red > 0) rec.red = 0, rec.yellow = total; // ç¬¬ä¸€è¼ªå‡ç´š
        else if (rec.yellow > 0) rec.yellow = 0, rec.green = total;
        else if (rec.green > 0) rec.green = 0, rec.blue = total;
        else rec.blue = total;
      } else {
        rec.red = total;
      }

      localStorage.setItem("colorRecord", JSON.stringify(colorRecord));

      const container = document.getElementById("mainContainer");
      container.innerHTML = `
        <h2>çµ±è¨ˆçµæœ</h2>
        <div class="progress-bar" style="height:20px;">
          <div class="bar-red" style="width:${(rec.red/total)*100}%;height:100%;float:left;"></div>
          <div class="bar-yellow" style="width:${(rec.yellow/total)*100}%;height:100%;float:left;"></div>
          <div class="bar-green" style="width:${(rec.green/total)*100}%;height:100%;float:left;"></div>
          <div class="bar-blue" style="width:${(rec.blue/total)*100}%;height:100%;float:left;"></div>
        </div>
        <p>ç´…ï¼š${rec.red}ã€€é»ƒï¼š${rec.yellow}ã€€ç¶ ï¼š${rec.green}ã€€è—ï¼š${rec.blue}ã€€ï¼ˆå…± ${total} é¡Œï¼‰</p>
        <button class="btn btn-gray" onclick="initHome()">å›é¦–é </button>
        <button class="btn btn-primary" onclick="startSection('${currentSheet}','${currentSection}')">é‡æ–°åˆ·æœ¬å°ç¯€</button>
      `;
    }

    // === æ¸…é™¤ç´€éŒ„ ===
    function resetRecord() {
      if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰åˆ·é¡Œç´€éŒ„å—ï¼Ÿ")) {
        localStorage.removeItem("colorRecord");
        colorRecord = {};
        initHome();
      }
    }

    // === åˆå§‹åŒ– ===
    window.onload = initHome;
  </script>
</body>
</html>
